{% extends 'default_e_bell.html' %}

{% set nav_title='Alerts' %}

{% block e_bell_content %}
<div class="boxy">
    <button type="button" class="mark-btn vertical-center" onclick="markRead()">Mark all as Read</button>
</div>
    <div class="d-flex flex-wrap justify-content-around">
        {% for type in types %}
            {% if 1 == type %}
                <!--system alert-->
                <div class="card m-2" class = "card">
                    <button type="button" onclick="bigPic(this)" class="card-body card-hover card-hover-grey">
                      {% if checks[loop.index0] == false %}
                      <img style="width: 50px; float: right;" src="{{ url_for('static', filename='alert.png') }}">
                      {% endif %}
                      <h2 class="card-title">Announcement</h2>
                      <h4>Message</h4>
                      <h3 class="card-subtitle text-muted date">{{ dates[loop.index0] }}</h3> 
                      <img class = "target" style="width: 50px; float: right;" src="{{ url_for('static', filename='announcement.png') }}">                  
                       
                      
                    </button>
                  </div>
            {% elif 2 == type %}
                  <!--system alert-->
                <div class="card m-2" class = "card">
                    <button type="button" onclick="bigPic(this)" class="card-body card-hover card-hover-green">
                      {% if checks[loop.index0] == false %}
                      <img style="width: 50px; float: right;" src="{{ url_for('static', filename='alert.png') }}">
                      {% endif %}
                      <h2 class="card-title">Doorbell Added</h2>
                      <h4>{{ doorbells[loop.index0] }}</h4>
                      <h3 class="card-subtitle text-muted date">{{ dates[loop.index0] }}</h3> 
                      <img class = "target" style="width: 50px; float: right;" src="{{ url_for('static', filename='camera.png') }}">                  
                       
                      
                    </button>
                </div>
            {% elif 3 == type %}
                <!--bell rang-->
                <div class="card m-2" class = "card">
                    <button type="button" onclick="bigPic(this)" class="card-body card-hover card-hover-purple">
                      {% if checks[loop.index0] == false %}
                      <img style="width: 50px; float: right;" src="{{ url_for('static', filename='alert.png') }}">
                      {% endif %}
                      <h2 class="card-title">{{ doorbells[loop.index0] }}</h2>                  
                      <h4>Bell Was Rang</h4>
                      <h3 class="card-subtitle text-muted date">{{ dates[loop.index0] }}</h3> 
                      {% if ".mp4" in paths[loop.index0]  %}
                        <video loop autoplay class = "target" style="width: 50px; float: right;" src="{{ paths[loop.index0] }}">
                      {% else %}
                        <img class = "target" style="width: 50px; float: right;" src='{{ paths[loop.index0] }}'>
                      {% endif %}                  
                      
                    </button>
                  </div> 
            {% else %}    
                <!--movimento detetado-->
                <div class="card m-2" class = "card">
                    <button type="button" onclick="bigPic(this)" class="card-body card-hover card-hover-red">
                      {% if checks[loop.index0] == false %}
                      <img style="width: 50px; float: right;" src="{{ url_for('static', filename='alert.png') }}">
                      {% endif %}
                      <h2 class="card-title">{{ doorbells[loop.index0] }}</h2>
                      <h4>Movement Detected</h4>
                      <h3 class="card-subtitle text-muted date">{{ dates[loop.index0] }}</h3>
                      {% if ".mp4" in paths[loop.index0]  %}
                        <video loop autoplay class = "target" style="width: 50px; float: right;" src="{{ paths[loop.index0] }}">
                      {% else %}
                        <img class = "target" style="width: 50px; float: right;" src='{{ paths[loop.index0] }}'>
                      {% endif %}  
                       
                 
                    </button>
                  </div>     
                     
            {% endif %}  
        {% endfor %}
    </div>


    <div class="popup-pic" id = "big1">
        <span id="span1">&times;</span>
        <img src='{{ paths[0] }}' alt="">
      </div>
      <div class="popup-pic" id = "big2">
          <span id="span2">&times;</span>
          <video src='{{ paths[0] }}' alt="" controls>
      </div>
  
        <script>

            function bigPic(elem){
              var path = elem.querySelector(".target").src;
              if(path.includes(".mp4")){
                    document.getElementById('big2').style.display = 'block';
                    document.querySelector('.popup-pic video').src = path;
              }else{
                document.getElementById('big1').style.display = 'block';
                document.querySelector('.popup-pic img').src = path;
              }
            }

  
            document.getElementById('span1').onclick = () =>{
              document.getElementById('big1').style.display = 'none';
            };
            document.getElementById('span2').onclick = () =>{
              document.getElementById('big2').style.display = 'none';
            };

            function markRead(){
              var dates = []
              document.querySelectorAll(".date").forEach(element => {
                dates.push(element.textContent)
                console.log(element.textContent)
              });
              console.log(dates)
              var date = dates.reduce((a, b) => a > b ? a : b); //reduce list to just the most recent date
                //needs a post here to tell server to mark all notifications up to older than (and as old as) "date"
              console.log(date)
              }
        

    </script>
    
{% endblock %}